@using System.Globalization;
@{
    ViewBag.Title = "Home Page";
}

<div class="jumbotron">
    <h1>Velkommen til ProjectFood</h1>
    <p>
        ProjectFood er <b>din digitale indkøbsassistent.</b><span class="hidden-xs"> Med dette program kan du få hjælp til alt relateret til indkøb og madlavning.<br />Du kan:</span>
        <ul class="hidden-xs lead">
            <li><a href="@Url.Action("Index", "ShoppingLists")">Oprette og dele indkøbslister</a></li>
            <li><a href="@Url.Action("Index", "Offer")">Se tilbud og tilføje disse til dine indkøbslister</a></li>
            <li><a href="@Url.Action("WatchList", "ShoppingLists")">Tilføje varer du gerne vil overvåge tilbud på</a></li>
            <li><a href="@Url.Action("Index", "Recipes")">Se og tilføje opskriter</a></li>
        </ul>
    <p class="hidden-xs">ProjectFood er et 3. semester projekt udført af en gruppe software-studerende på Aalborg Universitet</p>
</div>
<div class="row visible-xs">&nbsp;</div>

@if (User.Identity.IsAuthenticated)
{
    <div class="row">
        @if (ViewBag.ShoppingLists != null)
        {
            <div class="col-md-6">
                <div class="panel panel-primary">
                    <div class="panel-heading lead">Dine indkøbslister</div>
                    <div class="panel-body">
                        <div class="list-group">
                            @foreach (var list in (IEnumerable<ProjectFood.Models.ShoppingList>)ViewBag.ShoppingLists)
                            {

                                <a href="@Url.Action("Details", "ShoppingLists", new {id = list.ID})" class="list-group-item lead">
                                    @CultureInfo.CurrentCulture.TextInfo.ToTitleCase(list.Title)
                                    <span class="badge">@list.Items.Count</span>
                                </a>
                            }
                            @if (((IEnumerable<ProjectFood.Models.ShoppingList>)ViewBag.ShoppingLists).Count() == 0)
                            {
                                <a onclick=" $('div#createModal').modal('show'); setTimeout(function() { $('input#title').focus() }, 1000); "
                                   class="list-group-item list-group-item-info"
                                   style="cursor: pointer">
                                    Opret ny indkøbsliste
                                </a>
                                @Html.Partial("_CreateShoppingList")
                            }
                            else
                            {
                                <a href="@Url.Action("Index", "ShoppingLists")" class="list-group-item list-group-item-info">
                                    Se alle indkøbslister
                                </a>
                            }

                        </div>
                    </div>
                </div>
            </div>
        }
        @if (ViewBag.WatchList != null)
        {
            <div class="col-md-6">
                <div class="panel panel-primary">
                    <div class="panel-heading lead">Tilbud til dig</div>
                    <div class="panel-body">
                        <div class="list-group">
                            @foreach (var item in ((ProjectFood.Models.ShoppingList)ViewBag.WatchList).Items)
                            {

                                <a href="@Url.Action("WatchList", "ShoppingLists", new { itemID = item.ID })" class="list-group-item lead">
                                    @(item.Name.First().ToString().ToUpper() + item.Name.Substring(1))
                                    <span class="badge">@item.Offers.Count</span>
                                </a>
                            }
                            <a href="@Url.Action("WatchList", "ShoppingLists")" class="list-group-item list-group-item-info">
                                @(((ProjectFood.Models.ShoppingList)ViewBag.WatchList).Items.Count == 0 ?
                                    "Tilføj varer til din overvågningsliste" :
                                    "Rediger overvågningsliste")
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
    <div class="row">
        <div class="col-md-12">
            <div class="panel panel-primary">
                <div class="panel-heading lead">Anbefalede opskrifter</div>
                <div class="panel-body nopadding-xs">
                    <!--Super secret feature... disabled for now-->
                    <div class="visible-xs">
                        <div id="carousel-recipe" class="carousel slide nopadding" data-ride="carousel" data-interval="3000">
                            <!-- Wrapper for slides -->
                            <div class="carousel-inner" role="listbox">
                                @{
        int k = 0;
        foreach (var recipe in ((IEnumerable<ProjectFood.Models.Recipe>)ViewBag.Recipes).Take(3))
        {
            <div class="item @(k == 0 ? "active" : "")">
                <div class="panel panel-default"
                     style="cursor: pointer;"
                     onclick="window.location='@Url.Action("Details", "Recipes", new {id = recipe.ID})'">
                    <div class="panel-heading"><h3>@recipe.Title</h3></div>
                    <div class="panel-body">
                        <h4><span class="glyphicon glyphicon-time"></span>&nbsp;&nbsp;@Html.DisplayFor(modelItem => recipe.Minutes) Minutter</h4>
                        <h4>
                            <span class="glyphicon glyphicon-star"></span>
                            @if (recipe.Ratings.Select(x => x.Score).Count() == null || recipe.Ratings.Select(x => x.Score).Count() == 0)
                            {
                                <span>Ingen vuderinger givet</span>
                            }
                            else
                            {
                                var rat = recipe.Ratings.Select(x => x.Score);
                                @rat.Average().ToString("0.##")
                            }
                        </h4>
                        <table class="table-condensed">
                            @foreach (var ingredient in recipe.Ingredients.Take(3))
                            {
                                <tr>
                                    <td class="text-nowrap">@ingredient.Name</td>
                                </tr>
                            }
                            @if (recipe.Ingredients.Count() > 3)
                            {
                                <tr>
                                    <td>&hellip;</td>
                                </tr>
                            }
                            else
                            {
                                for (int ij = recipe.Ingredients.Count; ij <= 4; ij++)
                                {
                                    <tr><td>&nbsp;</td></tr>
                                }
                            }
                        </table>
                    </div>
                </div>
            </div>
                            k++;
        }
                                }
                            </div>
                        </div>
                        <div class="text-center">
                            <a class="btn btn-primary" href="#carousel-recipe" role="button" data-slide="prev" style="background-image:none;">
                                <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                                <span class="sr-only">Previous</span>
                            </a>
                            <a class="btn btn-primary" href="#carousel-recipe" role="button" data-slide="next" style="background-image:none;">
                                <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                                <span class="sr-only">Next</span>
                            </a>
                        </div>
                        <div class="row">&nbsp;</div>
                    </div>

                    @{
        int i = 1;
        if (ViewBag.Recipes != null)
        {
            foreach (var recipe in ((IEnumerable<ProjectFood.Models.Recipe>)ViewBag.Recipes).Take(3))
            {
                <div class="hidden-xs col-md-4">
                    <div class="panel panel-default"
                         style="cursor: pointer;"
                         onmouseover=" $(this).removeClass('panel-default').addClass('panel-info'); "
                         onmouseout=" $(this).addClass('panel-default').removeClass('panel-info'); "
                         onclick="window.location = '@Url.Action("details", "Recipes", new {id = recipe.ID})'">

                        <div class="panel panel-heading">
                            <h3>@recipe.Title</h3>
                        </div>
                        <div class="panel-body">
                            <h4><span class="glyphicon glyphicon-time"></span>&nbsp;&nbsp;@Html.DisplayFor(modelItem => recipe.Minutes) Minutter</h4>
                            <h4>
                                <span class="glyphicon glyphicon-star"></span>
                                @{
                if (recipe.Ratings.Select(x => x.Score).Count() == null || recipe.Ratings.Select(x => x.Score).Count() == 0)
                {
                    <span>Ingen vuderinger givet</span>
                }
                else
                {
                    var rat = recipe.Ratings.Select(x => x.Score);

                    @rat.Average().ToString("0.##")
                    ;
                }
                                }
                            </h4>
                            <table class="table-condensed">
                                @foreach (var ingredient in recipe.Ingredients.Take(3))
                                {
                                    {

                                    }
                                    <tr>
                                        <td>@ingredient.Name</td>
                                    </tr>
                                }
                                @if (recipe.Ingredients.Count() > 3)
                                {
                                    <tr>
                                        <td>&hellip;</td>
                                    </tr>
                                }
                            </table>
                        </div>
                    </div>
                </div>
            }
        }
                    }
                </div><a class="list-group-item list-group-item-info" href="@Url.Action("Index", "Recipes")">Se alle opskrifter</a>
            </div>
        </div>


    </div>
}