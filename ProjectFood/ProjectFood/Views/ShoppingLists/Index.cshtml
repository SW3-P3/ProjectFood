@using ProjectFood.Models
@model IEnumerable<ProjectFood.Models.ShoppingList>

@{
    ViewBag.Title = "Indkøbslister";
}
<div class="page-header nopadding-xs">
    <div class="container-fluid nopadding">
        <div class="col-md-9 col-xs-12 nopadding">
            <h1><span class="glyphicon glyphicon-list"></span>&nbsp;&nbsp;Indkøbslister</h1>
            <p class="hidden-xs lead text-muted">
                Her kan du lave indkøbslister, tilføje varer til listerne, samt finde tilbud for de indtastede varer.
                Du kan desuden dele indkøbslisten med andre brugere ved at dele den med deres e-mail.
            </p>
        </div>
        <div class="col-md-3 col-xs-12 nopadding">
            <div class="row hidden-xs">&nbsp;</div>
            <div onclick="$('div#createModal').modal('show'); setTimeout(function () { $('input#title').focus() }, 500);" class="btn btn-success btn-lg btn-block">
                Opret ny indkøbsliste
            </div>
            <div class="row visible-xs">&nbsp;</div>
        </div>
    </div>
</div>
@Html.Partial("_CreateShoppingList")
<div class="container-fluid nopadding">
    <h2 class="nopadding-xs">Personlige</h2>
    @if(Model.Count() < 1) {
        <div class="alert alert-warning" role="alert"
             onclick="$('div#createModal').modal('show'); $('input#title').focus();"
             style="cursor:pointer">
            Du har ingen personlige indkøbslister. Klik her for at oprette en.
        </div>
    }

    <table class="table table-striped table-hover">
        @foreach(var list in Model) {
            <tr>
                <td class="lead"
                    style="vertical-align:middle; cursor:pointer;"
                    onclick="window.location = '@Url.Action("Details", new { id = list.ID })'">
                    &nbsp;&nbsp;
                    @Html.DisplayFor(modelItem => list.Title)
                    <span class="badge">@(((IEnumerable<ProjectFood.Models.ShoppingList>)ViewBag.NumItems).Where(x => x.ID == list.ID).First().Items.Count)</span>
                </td>
                <td class="col-md-2 hidden-xs">
                    @Html.ActionLink("Tilføj og fjern varer", "Details", new { id = list.ID }, new { @class = "btn btn-info btn-block" })
                </td>
                <td class="col-md-1 hidden-xs text-center">
                    <div onclick="$('#shoppingListTitle_edit').html('@list.Title'); $('#shoppingListID_edit').val('@list.ID'); $('#editShoppingListModal').modal('show');"
                         class="btn btn-info">
                        <span class="glyphicon glyphicon-pencil"></span> Rediger titel
                    </div>
                </td>
                <td class="col-md-1 col-xs-1 text-center">

                    <div onclick="$('#shoppingListTitle_delete').html('@list.Title'); $('#shoppingListID_delete').val('@list.ID'); $('#deleteShoppingListModal').modal('show');" 
                         class="btn btn-danger">
                        <span class="glyphicon glyphicon-remove"></span>
                    </div>
                </td>
            </tr>
        }

    </table>

</div>

@Html.Partial("_Delete")
@Html.Partial("_Edit")

<div class="container-fluid nopadding">
    <h2 class="nopadding-xs">Delte</h2>
    @if(((IEnumerable<ShoppingList>)ViewBag.SharedLists).Count() < 1) {
        <div class="alert alert-info alert-dismissible" role="alert">
            <button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            Du har ingen delte indkøbslister
        </div>
    }
    
    <table class="table table-striped table-hover">
        @foreach(ShoppingList list in ViewBag.SharedLists) {
            <tr>
                <td class="lead"
                    style="vertical-align:middle; cursor:pointer;"
                    onclick="window.location = '@Url.Action("Details", new { id = list.ID })'">
                    &nbsp;&nbsp;
                    @list.Title
                    <span class="badge">@(((IEnumerable<ProjectFood.Models.ShoppingList>)ViewBag.NumItems).Where(x => x.ID == list.ID).First().Items.Count)</span>
                </td>
                <td class="col-md-2 hidden-xs">
                    @Html.ActionLink("Tilføj og fjern varer", "Details", new { id = list.ID }, new { @class = "btn btn-info btn-block" })
                </td>
                <td class="col-md-1 col-xs-1 text-center">
                    <div onclick="$('#shoppingListTitle_edit').html('@list.Title'); $('#shoppingListID_edit').val('@list.ID'); $('#editShoppingListModal').modal('show');"
                         class="btn btn-info">
                        <span class="glyphicon glyphicon-pencil"></span> Rediger titel
                    </div>
                </td>
                <td class="col-md-2 col-xs-1 text-center">

                    <div onclick="$('#shoppingListTitle_delete').html('@list.Title'); $('#shoppingListID_delete').val('@list.ID'); $('#deleteShoppingListModal').modal('show');"
                         class="btn btn-danger">
                        <span class="glyphicon glyphicon-remove"></span>
                    </div>
                </td>
            </tr>
        }

    </table>
</div>



@section Scripts {                              @*  Don't question the JavaScript-Gods!!!                             *@
@Scripts.Render("~/bundles/homemade")   @*  Magic part that makes the buttons change if POST was succesfull   *@
@Scripts.Render("~/bundles/jqueryval")  @*  Magic part that makes the AJAX POST possible                      *@
}
